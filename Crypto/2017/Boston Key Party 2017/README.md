# Boston Key Party 2017 - Notes

## rsa-buffet
> Description:
>
> There are 10 public keys and 5 ciphertexts using them. If you can decode any three you can get a flag. rsa-buffet

題目給了我們五個密文和十個金鑰，我們最少需要解掉三個密文才可以 (因為其用 secretsharing)

可以先存一下看每一把 key
```
from Crypto.PublicKey import RSA

key = []
for i in range(10):
	key.append(RSA.importKey(open("key-" + str(i) +".pem", "r").read()))
```

會發現 key-3.pem 的 e 特別大，可以嘗試 wiener attack 
得到 d = 9420364147446085639274379387786973162152074307922801332015153785267117724595265070646876503524212628628959579565360669628828274045000595263801870978909279

就是可以一個個 try 找方法解，但 rsa 實際上已經有人寫好工具可以自動化解 ...

[RsaCtfTool](https://github.com/sourcekris/RsaCtfTool)

這裡整理一下得到的
```
d0 = 481008451494019580387299416403900830469165420509642358413882750707102447652010629576442878171839736781022370486012556919431854248628724917349722997594644940369132821481596764438387800618026060595443839900037692888772192551771842968578545280853597899949381612595290145926094914248385675452132754341930515623172009719971388548160730266102183722012380114506507269329805758914062796598647087401745818176865917400471023124442400595720280861002779187990353556990686977474190884798732103231825772473820689647252970003858172382786659703280612233831936010402093754114606791019113632255333370442947952352018496289615175208854666319443634646890155501178923947463524339995653924310044469224216239636720946259724349550640529172269776136410799735953160898279118497257891194224767035521751640492461907641885904407928356574667104716550117451094639888915644518797090898717551247964766226484968210910551918471204441316272111258154748976291641803708225398207692907747744552058776277033863762008671127975235321866592181449003632578242742841971376233586660643800598616406624521292501004611259287761626702433081850431458959425961188241372933612469693569423567251324237426261135665408682310892356584053355956562774836161677202524156576891412598375261732713L

d1 = 105167255382644895571312972761205179733122000170951354267154421253189833306505095265761207795353985354866554008909912765602070548707906837222448483145839878289463148365919513525444080771203463232062923944731237185453081043325693606594798126030587104605037570174567693074686722115522456100623465726801160698239559061091663486985210248549207570980296827578451751964778610951987464867684030722466844105172829148645162675774051966004725828347088057209508827310574501913860263606270856503771824888033781045424661699281385347100922662627583540493598137771508306741473045595581095804916073185804638838310604570491241502655886359339236897876949613528096999331438300999697708890299457985911979849627712851924641477438819469128446227689597941291781062576314559706276978573964820852140872917686416671222571779079770092655409824631889898330085107957931952535103249730281354110146652618132315412533254982323032844101070334909207844326088015459725977566927881155952603824904793104799539283271748779039140727801683586005058013040278503739527750712067713109869489272754182635571360822835367404551020717132523980303574951279666353404286050161901053718140662127383907417324478531803286952584000534157988329219321166046552980660094722243468500414445057L

d2 = 82360526616896807698693573199664438409937065969470070589061697203467920610817023646959077756968989532459091749350432099444980199654188634836861161137356662441445859352927217157270793987104238155332957760232748731947002017400746597944533389986864375329359088386551101208283522331411651732989376273218842814180319110433001694202809406529081151328224220501000292507144740713386831323918799559242796888829373272839049340208231242397384963518461448183826706394044211875954303427851825251639033541902213506905901969121366029468891668656797568632939181423824723939930127468565302483191827000307215869460583072592787394379648492838431373480501883096871724639329379422198017519406310001449118250257352155151242793946860974388275256551958325634162505006352633974367733621639608704430697868358325477517705349062070604806141047285976585695001741441171974331457858532665535006295162620342801636572553939160973573287838150248262669409134863998676177317567799700878113228884526337190956961963516058441888168118633266674943833985047193671213626257221952126625834587189721310168003199270210218744859703599407641156335251120773805978641928778006104069967130056321615203155638339974487535580497188409267435564860804781546983286452847097738671150588113L

d3 = 9420364147446085639274379387786973162152074307922801332015153785267117724595265070646876503524212628628959579565360669628828274045000595263801870978909279

d6 = 721191688220259225212882413970306893386028335596160008376451204769296799679273345851492094367190761781725256869532011729034379872636952447834494608107088276506146085866318910266005204660324757975391206400682340496842926224075216278212660048356463409169080517973734712222420100493408556831952864771017564478696758673222936808702101415196535414831163920171310417648784085776393193134004860341059605328202038910671499668354891425876655610784570360506613761666538458172910192198679146237672699328560281412128527651018717126498704419919397802287445836612747104943628253920362761459713338156724137301649252273862322189657902670565501638115915842312168192035306801439995555033844235943336091071308455141527109573245515241442867919003222667328858661835219509364430813502407540126021720418496926414892357844928915642165007862585242257219987365006546161661900139407261272997093588897070572627082597614555368108495336373604358767710689650722126937657272222443989617551733439301604282493241228268787747840047648117273651708763236784358192582507075928163197505184961282609141019215899581197040983910800452824799702184076199741463576373022568563200083869329095884398213316589495136460272142045132620619486975289393170586048926615322883432900453921L
```

透過 RsaCtfTool 總共得到: 0, 1, 2, 3, 6 的私鑰


接下來我們至少要 decrypt 三個 cipertext ，可以參考一下 encrypt.py 的 decrypt
```
def decrypt(private_key, ciphertext):
  """Decrypt a message with a given private key.

  Takes in a private_key generated by Crypto.PublicKey.RSA, which must be of
  size exactly 4096

  If the ciphertext is invalid, return None
  """
  if len(ciphertext) < 512 + 16:
    return None
  msg_header = ciphertext[:512]
  msg_iv = ciphertext[512:512+16]
  msg_body = ciphertext[512+16:]
  try:
    symmetric_key = PKCS1_OAEP.new(private_key).decrypt(msg_header)
  except ValueError:
    return None
  if len(symmetric_key) != 32:
    return None
  return AES.new(symmetric_key,
      mode=AES.MODE_CFB,
      IV=msg_iv).decrypt(msg_body)

```


和參考一下 generate-plaintexts.py ，知道他有用 `Shamir secret sharing`


那現在就可以來解密了


