<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'common.php'</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">]&nbsp;===&nbsp;</span><span style="color: #DD0000">'GET'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">highlight_string</span><span style="color: #007700">(</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"execute.php"</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">);<br />&nbsp;&nbsp;exit(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$keys&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">get_keys</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$privkey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$keys</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$pubkey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$keys</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">$file_info&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'userfile'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">check_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$file_info</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$file_info</span><span style="color: #007700">[</span><span style="color: #DD0000">'tmp_name'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">$signature&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">hex2bin</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'signature'</span><span style="color: #007700">]);<br />if&nbsp;(</span><span style="color: #0000BB">openssl_verify</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$signature</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pubkey</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">'Signature&nbsp;is&nbsp;OK.&lt;br/&gt;'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Bad&nbsp;signature.'</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">pdf_to_text</span><span style="color: #007700">(</span><span style="color: #0000BB">$file_info</span><span style="color: #007700">[</span><span style="color: #DD0000">'tmp_name'</span><span style="color: #007700">]);<br />print&nbsp;</span><span style="color: #DD0000">"Text:&nbsp;\"</span><span style="color: #0000BB">$text</span><span style="color: #DD0000">\"&lt;br/&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$execute_query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"EXECUTE&nbsp;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$echo_query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"ECHO&nbsp;"</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute_query</span><span style="color: #007700">))&nbsp;===&nbsp;</span><span style="color: #0000BB">$execute_query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$payload&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute_query</span><span style="color: #007700">));<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"About&nbsp;to&nbsp;execute:&nbsp;\"</span><span style="color: #0000BB">$payload</span><span style="color: #DD0000">\".&lt;br/&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">shell_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$payload</span><span style="color: #007700">);<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"Output:&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;if&nbsp;(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$echo_query</span><span style="color: #007700">))&nbsp;===&nbsp;</span><span style="color: #0000BB">$echo_query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$payload&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$echo_query</span><span style="color: #007700">));<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"About&nbsp;to&nbsp;echo:&nbsp;\"</span><span style="color: #0000BB">$payload</span><span style="color: #DD0000">\".&lt;br/&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$payload</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"I&nbsp;can't&nbsp;recognize&nbsp;the&nbsp;command&nbsp;type.&nbsp;Go&nbsp;away.&lt;br/&gt;"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span>
</span>
</code>